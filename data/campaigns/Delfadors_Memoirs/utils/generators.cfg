#textdomain wesnoth-dm

#define MEMOIRS_GENERATOR_SKELETON X Y
    # set the generator's terrain
    [event]
        name=prestart
        [item]
            x,y={X},{Y}
            image=scenery/monolith2.png
        [/item]
    [/event]

    # generate a unit each turn
    [event]
        id=generator_{X}_{Y}
        name=new turn
        first_time_only=no

        [scroll_to]
            x,y={X},{Y}
        [/scroll_to]
        [sound]
            name=magic-dark.ogg
        [/sound]
        {RANDOM (Skeleton,Skeleton Archer)}
        [unit]
            type=$random
            side=2
            x,y={X},{Y}
            animate=yes
        [/unit]
        {CLEAR_VARIABLE random}
    [/event]

    # if someone capable of destroying the generator moves there
    [event]
        name=moveto
        [filter]
            side=1
            x,y={X},{Y}
            type_adv_tree=Mage,Journeyman Mage,Paladin
        [/filter]

        [message]
            speaker=unit
            message=_"I call upon all that is holy to break the power of this evil stone!"
        [/message]
        [sound]
            name=lightning.ogg
        [/sound]
        [color_adjust]
            red=100
            green=100
            blue=100
        [/color_adjust]
        [delay]
            time=10
        [/delay]
        [color_adjust]
            red=0
            green=0
            blue=0
        [/color_adjust]
        [remove_event]
            id=generator_{X}_{Y}
        [/remove_event]
        [set_variable]
            name=generators_destroyed
            add=1
        [/set_variable]
        [if]
            [variable]
                name=generators_destroyed
#ifndef HARD
                greater_than=1
#endif
#ifdef HARD
                greater_than=2
#endif
            [/variable]
            [then]
                [if]
                    [not]
                        [have_unit]
                            side=2
                        [/have_unit]
                    [/not]
                    [then]
                        [message]
                            speaker=Delfador
                            message=_"I think that’s all of them! Let’s move on — the less time we spend in this swamp the better."
                        [/message]
                        {CLEAR_VARIABLE generators_destroyed}
                        [endlevel]
                            result=victory
                            bonus=yes
                        [/endlevel]
                    [/then]
                    [else]
                        [objectives]
                            side=1
                            [objective]
                                description=_ "Survive until daybreak"
                                condition=win
                                show_turn_counter=yes
                            [/objective]
                            [objective]
                                {ALTERNATIVE_OBJECTIVE_CAPTION}
                                description=_ "Defeat remaining enemy units"
                                condition=win
                            [/objective]
                            [objective]
                                description=_ "Death of Delfador"
                                condition=lose
                            [/objective]
                            [objective]
                                description=_ "Death of Lionel"
                                condition=lose
                            [/objective]

                            [gold_carryover]
                                bonus=yes
                                carryover_percentage=80
                            [/gold_carryover]
                        [/objectives]
                            # if the player manages to destroy all generators he then has to kill remaining enemy units. an unlikely outcome unless we are on EASY. The following child event is spawned from this condition.
                        [event]
                            name=die
                            first_time_only=no
                            [filter]
                                side=2
                            [/filter]
                            [if]
                                [not]
                                    [have_unit]
                                        side=2
                                    [/have_unit]
                                [/not]
                                [then]
                                    [message]
                                        speaker=Delfador
                                        message=_"I think that’s all of them! Let’s move on — the less time we spend in this swamp the better."
                                    [/message]
                                    {CLEAR_VARIABLE generators_destroyed}
                                    [endlevel]
                                        result=victory
                                        bonus=yes
                                    [/endlevel]
                                [/then]
                            [/if]
                        [/event]
                    [/else]
                [/if]
            [/then]
        [/if]
    [/event]

    # if someone who can't destroy the generator moves there
    [event]
        name=moveto
        [filter]
            x,y={X},{Y}
            side=1
            [not]
                type_adv_tree=Mage,Journeyman Mage,Paladin
            [/not]
        [/filter]

        [message]
            speaker=unit
            message=_"Evil emanates from this stone, but I have not the power to destroy it."
        [/message]
    [/event]
#enddef
